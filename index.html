<!DOCTYPE html>
<html lang="en" ng-app="test.store.app">
<head>
    <meta charset="UTF-8">
    <title></title>
</head>
<body ng-controller="MainController as main">
    <h1 ng-bind="main.title"></h1>
    <p ng-bind="main.body"></p>
    <hr/>
    <p ng-bind="main.subtext"></p>

    <script type="text/javascript" src="bower_components/angular/angular.min.js"></script>
    <script type="text/javascript" src="Store.js"></script>
    <script type="text/javascript" src="StoreProvider.js"></script>
    <script type="text/javascript">

        angular.module('test.store.app', ['store.module'])
                .config(function(StoreProvider) {

                })
                .factory('MainService', ['$q', 'Store', function($q, Store) {
                    var store = new Store();
                    var defaultHeaders = {
                        "cache-control": "no-cache"
                    };

                    store.setBaseUrl('api');

                    store.set('title', {
                        url: '/title/{id}.json',
                        headers: defaultHeaders,
                        store: true
                    });

                    store.set('body', {
                        url: '/body/{id}.json',
                        headers: defaultHeaders
                    });

                    store.set('subtext');

                    return {
                        store: store,
                        getAllData: getAllData,
                        getTitle: getTitle,
                        getBody: getBody,
                        updateTitle: updateTitle,
                        subtext: subtext
                    };

                    function getAllData() {
                        return $q.all([
                            getTitle(),
                            getBody()
                        ]);
                    }

                    function getTitle() {
                        return store.get('title', {
                            id: 0
                        });
                    }

                    function updateTitle() {
                        return store.post('title', {
                            name: 'Squirrel Title'
                        }, {
                            id: 1
                        });
                    }

                    function getBody() {
                        return store.get('body', {
                            id: 'random_id'
                        });
                    }

                    function subtext(value) {
                        return store.put('subtext', value);
                    }
                }])
                .controller('MainController', ['$timeout', 'MainService', function($timeout, MainService) {
                    var main = this;

                    MainService.getAllData().then(function(response) {
                        main.body = response[1].text;
                        main.title = MainService.store.title.text;

                        MainService.updateTitle().then(function() {
                            main.title = MainService.store.title.text;
                            console.log('MainService after update: ', MainService.store);
                        });
                    });

                    main.subtext = MainService.subtext('This is my subtext!');
                }]);
    </script>
</body>
</html>